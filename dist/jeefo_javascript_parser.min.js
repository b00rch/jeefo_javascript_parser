/**
 * jeefo_javascript_parser : v0.0.1
 * Author                  : je3f0o <je3f0o@gmail.com>
 * Homepage                : https://github.com/je3f0o/jeefo_javascript_parser
 * License                 : The MIT license
 * Copyright               : 2017
 **/
!function(e,t,r){"use strict";!function(e){!function(e){var t=e.module("jeefo_core",[]),r=function(e){return function(t,r,n,s){return"function"===typeof r?(s=n,n=r,r=[]):"string"===typeof r&&(r=[r]),void 0===s&&(s=!0),e.call(this,t,{fn:n,dependencies:r,resolve_once:s})}},n=function(e){var t=function(t,r){return(r?e:"")+t.toLowerCase()};return function(){return this.replace(/[A-Z]/g,t)}};String.prototype.dash_case=n("-"),String.prototype.snake_case=n("_"),t.extend("curry",["$injector"],function(e){return r(function(t,r){e.register((t+"Curry").snake_case(),r)})}),t.curry("makeInjectable",function(){return r}),t.extend("run",["$injector"],function(e){var t=Array;return function(r,n){var s,i,a=0;if("function"===typeof r)n=r,i=[];else if("string"===typeof r)i=[e.resolve_sync(r)];else for(a=0,s=r.length,i=new t(s);a<s;++a)i[a]=e.resolve_sync(r[a]);return n.apply(this,i)}}),t.extend("namespace",["$injector","make_injectable_curry"],function(e,t){return t(function(t,r){for(var n,s,i=t.split("."),a=i.pop(),o=0,p=i.length,h="";o<p;++o)n=i[o],h&&(s=e.resolve_sync(h)),h=h?h+"."+n:n,e.has(h)||(e.register(h,{dependencies:[],resolve_once:!0,fn:function(){return{}}}),s&&(s[n]=e.resolve_sync(h)));e.register(t,r),h&&(s=e.resolve_sync(h),s[a]=e.resolve_sync(t))})}),t.extend("factory",["$injector","make_injectable_curry"],function(e,t){return t(function(t,r){e.register((t+"Factory").snake_case(),r)})}),t.extend("service",["$injector","make_injectable_curry"],function(e,t){return t(function(t,r){r.is_constructor=!0,e.register((t+"Service").snake_case(),r)})})}(e);var t=function(e){for(var t in e)this[t]=e[t]},r=t.prototype;r.error=function(e){var t=new SyntaxError(e);throw t.token=this.value,t.lineNumber=this.start.line,t.columnNumber=this.start.column,t},r.error_unexpected_type=function(){this.error("Unexpected "+this.type)},r.error_unexpected_token=function(){this.error("Unexpected token")};var n=function(e,t,r,n,s,i,a){this.type=e,this.name=t,this.start=r,this.end=n,this.skip=s||null,this.contains=i||null,this.ignore=a||null,i&&(this.contains_chars=this.find_special_characters(i)),a&&(this.ignore_chars=this.find_special_characters(a))};n.prototype.find_special_characters=function(e){for(var t=0,r=e.length;t<r;++t)if("SpecialCharacter"===e[t].type)return e[t].chars.join("")};var s=function(e){this.language=e,this.container=[]};r=s.prototype,r.register=function(e){this.container.push(new n(e.type,e.name,e.start,e.end,e.skip,e.contains,e.ignore))},r.find=function(e){for(var t,r,s,i,a=this.container,o=0,p=a.length,h=e.current_index;o<p;++o){for(r=a[o].start,t=!0,s=0,i=r.length;s<i;++s)if(e.peek(h+s)!==r[s]){t=!1;break}if(t)return new n(a[o].type,a[o].name,a[o].start,a[o].end,a[o].skip,a[o].contains,a[o].ignore)}return null};var i=function(e){this.string=e,this.current_index=0};r=i.prototype,r.peek=function(e){return this.string.charAt(e)},r.seek=function(e,t){return this.string.substring(e,e+t)},r.next=function(){return this.peek(this.current_index+=1)},r.current=function(){return this.peek(this.current_index)};var a=function(e,t){this.lines=[{number:1,index:0}],this.start={line:1,column:1},this.tokens=[],this.regions=t,this.language=e};r=a.prototype,r.parse=function(e){for(var t,r=this.streamer=new i(e),n=r.current();n;)n<=" "?this.handle_new_line(n):(t=this.regions.find(r),t?this.parse_region(t):n>="0"&&n<="9"?this.parse_number():-1===this.SPECIAL_CHARACTERS.indexOf(n)?this.parse_identifier():this.parse_special_character()),n=r.next();return this.tokens},r.IS_FINITE=isFinite,r.NUMBER_VALIDATION=[",",";","}","]",")","*","/","+","-","%"," ","\t","\r","\n","<",">","?",":","^","&","|","/"].join(""),r.parse_number=function(){var e,t=this.streamer;for(this.prepare_new_token(t.current_index),e=t.next();e>="0"&&e<="9";e=t.next());this.add_token(this.make_token("Number")),this.streamer.current_index-=1},r.SPECIAL_CHARACTERS=[",",".",";",":","<",">","~","`","!","@","#","|","%","^","&","*","(",")","-","+","=","[","]","/","?",'"',"{","}","\\","'","_"].join(""),r.parse_identifier=function(){var e,t=this.streamer;for(this.prepare_new_token(t.current_index),e=t.next();e>" "&&-1===this.SPECIAL_CHARACTERS.indexOf(e);e=t.next());this.add_token(this.make_token("Identifier")),t.current_index-=1},r.parse_region=function(e){var t,r,n,s,i=e.skip,a=e.end,o=this.streamer,p=a.length;if(this.prepare_new_token(o.current_index),o.current_index+=e.start.length,e.contains)return s=this.make_token(e.type),s.children=[],this.current_token?(e.parent=this.current_region,s.parent=this.current_token,this.current_token.children.push(s)):this.tokens.push(s),this.current_token=s,this.current_region=e,void(o.current_index-=1);for(n=o.current();n;){if(this.handle_new_line(n),i&&n===i[0]){for(r=!0,t=1;t<p;++t)if(o.peek(o.current_index+t)!==i[t]){r=!1;break}if(r){o.current_index+=i.length,n=o.peek(o.current_index);continue}}if(this.check_end_token(o.current_index,a))return o.current_index+=e.end.length,this.add_token(this.make_token(e.type,this.start.index+e.start.length,o.current_index-this.start.index-e.start.length-a.length)),void(o.current_index-=1);n=o.next()}},r.parse_special_character=function(){var e=this.streamer.current_index;if(this.current_token){var t=this.current_region.ignore_chars,r=this.current_region.contains_chars,n=this.streamer.current();if(this.check_end_token(e,this.current_region.end))return this.streamer.current_index+=this.current_region.end.length,this.set_end(this.current_token),this.set_value(this.current_token),this.current_token=this.current_token.parent,this.current_region=this.current_region.parent,void(this.streamer.current_index-=1);if(t&&t.indexOf(n)>=0)return;r&&-1!==r.indexOf(n)||(this.prepare_new_token(e),this.streamer.current_index+=1,this.make_token("SpecialCharacter").error_unexpected_token())}this.prepare_new_token(e),this.streamer.current_index+=1,this.add_token(this.make_token("SpecialCharacter")),this.streamer.current_index-=1},r.check_end_token=function(e,t){var r,n=this.streamer,s=1,i=t.length;if(n.peek(e)===t[0])for(r=!0;s<i;++s)if(n.peek(e+s)!==t[s]){r=!1;break}return r},r.handle_new_line=function(e){"\r"!==e&&"\n"!==e||this.new_line()},r.new_line=function(){this.lines.push({number:this.lines.length+1,index:this.streamer.current_index+1})},r.set_value=function(e){e.value=this.streamer.seek(e.start.index,e.end.index-e.start.index)},r.set_end=function(e){e.end={line:this.lines.length,column:this.streamer.current_index-this.lines[this.lines.length-1].index+1,index:this.streamer.current_index}},r.prepare_new_token=function(e){this.start={line:this.lines.length,column:e-this.lines[this.lines.length-1].index+1,index:e}},r.add_token=function(e){var t=this.current_token;t?(this.set_end(t),this.set_value(t),t.children.push(e)):this.tokens.push(e)},r.make_token=function(e,r,n){return void 0===r&&(r=this.start.index,n=this.streamer.current_index-this.start.index),new t({type:e,value:this.streamer.seek(r,n),start:this.start,end:{line:this.lines.length,column:this.streamer.current_index-this.lines[this.lines.length-1].index+1,index:this.streamer.current_index}})};var o=e.module("jeefo_tokenizer",["jeefo_core"]);o.namespace("tokenizer.Token",function(){return t}),o.namespace("tokenizer.Region",function(){return s}),o.namespace("tokenizer.TokenParser",function(){return a})}(e);var n=e.module("jeefo_javascript_parser",["jeefo_tokenizer"]);n.namespace("javascript.es5_regions",["tokenizer.Region"],function(e){var t=new e("javascript");return t.register({type:"Comment",name:"Inline comment",start:"//",end:"\n"}),t.register({type:"Comment",name:"Multi line comment",start:"/*",end:"*/"}),t.register({type:"String",name:"Double quote string",start:'"',skip:'\\"',end:'"'}),t.register({type:"String",name:"Single quote string",start:"'",skip:"\\'",end:"'"}),t.register({type:"String",name:"Single quote string",start:"`",skip:"\\`",end:"`"}),t.register({type:"Parenthesis",name:"Parenthesis",start:"(",end:")",contains:[{type:"Block"},{type:"Array"},{type:"String"},{type:"Number"},{type:"Comment"},{type:"Parenthesis"},{type:"SpecialCharacter",chars:["-","_","+","*","%","&","|","$","?","!","<",">","`","=",":",".",",",";"]}]}),t.register({type:"Array",name:"Array literal",start:"[",end:"]",contains:[{type:"Block"},{type:"Array"},{type:"String"},{type:"Number"},{type:"Comment"},{type:"Parenthesis"},{type:"SpecialCharacter",chars:["-","_","+","*","%","&","$","=",":",".",",",";"]}]}),t.register({type:"Block",name:"Block",start:"{",end:"}",contains:[{type:"Block"},{type:"Array"},{type:"String"},{type:"Number"},{type:"Comment"},{type:"Parenthesis"},{type:"SpecialCharacter",chars:["-","_","+","*","%","&","|","$","?","`","=","!",":",".",",",";"]}]}),t.register({type:"RegExp",name:"RegExp",start:"/",skip:"\\/",end:"/"}),t}),n.namespace("javascript.tokenizer",["tokenizer.TokenParser","javascript.es5_regions"],function(e,t){return function(r){return new e("javascript",t).parse(r)}}),n.namespace("javascript.Parser",["javascript.tokenizer","tokenizer.Token"],function(e,t){var r=["break","continue","return","do","for","while","switch","case","default","in","typeof","instanceof","try","catch","finally","throw","var","function","this","new","debugger","if","else","with","delete","void"],n=function(e){this.reserved=r,this.middlewares=e},s=n.prototype;s.EmptyStatement=function(e){this.type="EmptyStatement",this.start=e.start,this.end=e.end},s.IfStatement=function(e,t,r,n,s){this.type="IfStatement",this.test=r,this.statement=n,this.alternate=s||null,this.start=e,this.end=t},s.ForStatement=function(e,t,r,n,s,i){this.type="ForStatement",this.init=r,this.test=n,this.update=s,this.statement=i,this.start=e,this.end=t},s.ForInStatement=function(e,t,r,n,s){this.type="ForInStatement",this.left=r,this.right=n,this.statement=s,this.start=e,this.end=t},s.WhileStatement=function(e,t,r,n){this.type="WhileStatement",this.test=r,this.statement=n,this.start=e,this.end=t},s.SwitchStatement=function(e,t,r,n){this.type="SwitchStatement",this.test=r,this.cases=n,this.start=e,this.end=t},s.LabeledStatement=function(e,t,r,n){this.type="LabeledStatement",this.label=r,this.statement=n,this.start=e,this.end=t},s.TryStatement=function(e,t,r,n,s){this.type="TryStatement",this.block=r,this.handler=n,this.finalizer=s,this.start=e,this.end=t},s.ReturnStatement=function(e,t,r){this.type="ReturnStatement",this.argument=r,this.start=e,this.end=t},s.BreakStatement=function(e,t,r){this.type="BreakStatement",this.label=r,this.start=e,this.end=t},s.ContinueStatement=function(e,t,r){this.type="ContinueStatement",this.label=r,this.start=e,this.end=t},s.ExpressionStatement=function(e,t,r){this.type="ExpressionStatement",this.expression=r,this.start=e,this.end=t},s.BlockStatement=function(e,t){this.type="BlockStatement",this.body=t,this.start=e.start,this.end=e.end},s.ProgramStatement=function(e,t,r){this.type="ProgramStatement",this.body=r,this.start=e,this.end=t},s.NumberLiteral=function(e){this.type="NumberLiteral",this.value=e.value,this.start=e.start,this.end=e.end},s.StringLiteral=function(e){this.type="StringLiteral",this.value=e.value,this.start=e.start,this.end=e.end},s.ArrayLiteral=function(e,t){this.type="ArrayLiteral",this.elements=t,this.start=e.start,this.end=e.end},s.RegExpLiteral=function(e,t,r,n){this.type="RegExpLiteral",this.regex={pattern:r,flags:n},this.start=e,this.end=t},s.ObjectLiteral=function(e,t){this.type="ObjectLiteral",this.properties=t,this.start=e.start,this.end=e.end},s.MemberExpression=function(e,t,r,n,s){this.type="MemberExpression",this.object=r,this.property=n,this.is_computed=!!s,this.start=e,this.end=t},s.CallExpression=function(e,t,r,n){this.type="CallExpression",this.callee=r,this.arguments=n,this.start=e,this.end=t},s.NewExpression=function(e,t,r,n){this.type="NewExpression",this.callee=r,this.arguments=n,this.start=e,this.end=t},s.UnaryExpression=function(e,t,r,n,s){this.type="UnaryExpression",this.operator=r,this.argument=n,this.is_prefix=!!s,this.start=e,this.end=t},s.LogicalExpression=function(e,t,r,n,s){this.type="LogicalExpression",this.operator=n,this.left=r,this.right=s,this.start=e,this.end=t},s.BinaryExpression=function(e,t,r,n,s){this.type="BinaryExpression",this.operator=n,this.left=r,this.right=s,this.start=e,this.end=t},s.AssignmentExpression=function(e,t,r,n,s){this.type="AssignmentExpression",this.operator=n,this.left=r,this.right=s,this.start=e,this.end=t},s.ConditionalExpression=function(e,t,r,n,s){this.type="ConditionalExpression",this.test=r,this.consequent=n,this.alternate=s,this.start=e,this.end=t},s.SequenceExpression=function(e){this.type="SequenceExpression",this.expressions=e,this.start=e[0].start,this.end=e[e.length-1].end},s.FunctionExpression=function(e,t,r,n,s){this.type="FunctionExpression",this.id=r,this.parameters=n,this.body=s,this.start=e,this.end=t},s.VariableDeclaration=function(e,t,r){this.type="VariableDeclaration",this.declarations=r,this.start=e,this.end=t},s.VariableDeclarator=function(e){this.type="VariableDeclarator",this.id=e,this.init=null,this.start=e.start,this.end=e.end},s.FunctionDeclaration=function(e,t,r,n,s){this.type="FunctionDeclaration",this.id=r,this.parameters=n,this.body=s,this.start=e,this.end=t},s.Comment=function(e){this.type="Comment",this.comment=e.value,this.start=e.start,this.end=e.end},s.Property=function(e,t){this.type="Property",this.key=e,this.value=null,this.is_computed=!!t,this.start=e.start},s.CatchClause=function(e,t,r,n){this.type="CatchClause",this.param=r,this.body=n,this.start=e,this.end=t},s.SwitchCase=function(e,t,r,n){this.type="SwitchCase",this.test=r,this.statements=n,this.start=e,this.end=t},s.DefaultCase=function(e,t,r){this.type="DefaultCase",this.statements=r,this.start=e,this.end=t},s.Identifier=function(e){this.type="Identifier",this.name=e.value,this.start=e.start},s.Operator=function(e){this.type="Operator",this.operator=e},s.Piece=function(e){this.start_token=e},s.Temp=function(){},s.File=function(e,t,r){this.type="File",this.name=e,this.code=t,this.program=r},s.Program=function(e){this.type="Program",this.body=e,this.start=e.length?e[0].start:{line:1,column:1,index:0},this.end=e.length?e[e.length-1].end:{line:1,column:1,index:0}},s.parse=function(t,r){this.raw_tokens=e(r);var n=this.parse_block_statement(this.raw_tokens);return new this.File(t,r,new this.Program(n))},s.parse_statement=function(e,t,r){for(var n,s=r;s<t.length;++s)switch(t[s].type){case"Identifier":if(s===r)switch(t[s].value){case"function":return this.parse_function_declaration(e,t,r);case"var":return this.parse_variable_declaration(e,t,r,t.length);case"return":return this.parse_return_statement(e,t,r);case"if":return this.parse_if_statement(e,t,r);case"for":return this.parse_for_statement(e,t,r);case"while":return this.parse_while_statement(e,t,r);case"switch":return this.parse_switch_statement(e,t,r);case"try":return this.parse_try_statement(e,t,r);case"break":return this.parse_break_statement(e,t,r);case"continue":return this.parse_continue_statement(e,t,r)}break;case"Block":if(s===r)return e.statement=new this.BlockStatement(t[r],this.parse_block_statement(t[r].children)),s;break;case"SpecialCharacter":switch(t[s].value){case":":if(!n)return this.parse_labeled_statement(e,t,r);break;case";":return s===r?e.statement=new this.EmptyStatement(t[s]):this.parse_expression_statement(e,t,r,s),s;case"$":case"_":break;default:n=!0}break;case"Comment":return e.statement=new this.Comment(t[s]),s}throw Error("Executed unreachable code.")},s.parse_if_statement=function(e,t,r,n){var s,i,a,o=r+1;if(t[o]?"Parenthesis"===t[o].type?(s=this.parse_test(e,t[o].children),o+=1):t[o].error_unexpected_token():n.error_unexpected_token(),t[o]){if(o=this.parse_statement(e,t,o),!e.statement)throw Error("Fallback error");i=e.statement}else n.error_unexpected_token();if(t[o+1]&&"else"===t[o+1].value){if(!t[o+2])throw Error("Fallback error");o=this.parse_statement(e,t,o+2),a=e.statement}return e.statement=new this.IfStatement(t[r].start,t[o].end,s,i,a),o},s.parse_for_statement=function(e,t,r,n){var s,i,a,o,p,h,c=r+1;if(t[c])if("Parenthesis"===t[c].type){switch(this.parse_for_arguments(e,t[c].children),s=e.type){case"loop":i=e.init,a=e.test,o=e.update;break;case"in":p=e.left,h=e.right;break;default:throw Error("Fallback error")}++c}else t[c].error_unexpected_token();else n.error_unexpected_token();if(t[c]){if(c=this.parse_statement(e,t,c),!e.statement)throw Error("error");switch(s){case"loop":e.statement=new this.ForStatement(t[r].start,t[c].end,i,a,o,e.statement);break;case"in":e.statement=new this.ForInStatement(t[r].start,t[c].end,p,h,e.statement)}}else n.error_unexpected_token();return c},s.parse_while_statement=function(e,t,r,n){var s,i=r+1;if(t[i]?"Parenthesis"===t[i].type?(s=this.parse_test(e,t[i].children),i+=1):t[i].error_unexpected_token():n.error_unexpected_token(),t[i]){if(i=this.parse_statement(e,t,i),!e.statement)throw Error("Fallback error");e.statement=new this.WhileStatement(t[r].start,t[i].end,s,e.statement)}else n.error_unexpected_token();return i},s.parse_switch_statement=function(e,t,r,n){var s,i,a=r+1;if(t[a])if("Parenthesis"===t[a].type){if(this.parse_sequence_expression(e,t[a].children,0,t[a].children.length),!e.expression)throw Error("Fallback error");i=e.expression,a+=1}else t[a].error_unexpected_token();else n.error_unexpected_token();return t[a]?"Block"===t[a].type?s=this.parse_switch_cases(e,t[a].children):t[a].error_unexpected_token():n.error_unexpected_token(),e.statement=new this.SwitchStatement(t[r].start,t[a].end,i,s),a},s.parse_labeled_statement=function(e,t,r){var n,s;if(n=this.parse_identifier(e,t,r),s=e.identifier,!t[n+1])throw Error("Fallback error");return":"===t[n+1].value?(n=this.parse_statement(e,t,n+2,!0),e.statement=new this.LabeledStatement(t[r].start,e.statement.end,s,e.statement)):t[n+1].error_unexpected_token(),n},s.parse_try_statement=function(e,t,r,n){var s,i,a,o,p=r+1,h=null,c=null;if(t[p]?"Block"===t[p].type?(i=new this.BlockStatement(t[p],this.parse_block_statement(t[p].children)),p+=1):t[p].error_unexpected_token():n.error_unexpected_token(),t[p]&&"catch"===t[p].value){if(p+=1,t[p])if("Parenthesis"===t[p].type){if(s=this.parse_identifier(e,t[p].children,0),!e.identifier)throw Error("error");a=e.identifier,t[p].children.length>s+1&&t[p].children[s+1].error_unexpected_token(),p+=1}else t[p].error_unexpected_token();else n.error_unexpected_token();t[p]?"Block"===t[p].type?(o=new this.BlockStatement(t[p],this.parse_block_statement(t[p].children)),h=new this.CatchClause(t[p-2].start,t[p].end,a,o)):t[p].error_unexpected_token():n.error_unexpected_token()}if(t[p+1]&&"finally"===t[p+1].value)if(p+=2,t[p]){if("Block"!==t[p].type)throw Error("error");c=new this.BlockStatement(t[p],this.parse_block_statement(t[p].children))}else t[p].error_unexpected_token();if(!h&&!c)throw Error("Error");return e.statement=new this.TryStatement(t[r].start,t[p].end,i,h,c),p},s.parse_block_statement=function(e){var t=new this.Temp,r=0,n=[];if(this.middlewares.length)return this.parse_block_statement_with_middlewares(t,e,n);for(;r<e.length;++r)r=this.parse_statement(t,e,r),n.push(t.statement);return n},s.parse_block_statement_with_middlewares=function(e,t,r){for(var n,s=0,i=this.middlewares,a=0;s<t.length;++s){for(n=0;n<i.length&&!((a=this.parse_statement(e,t,s))>s);++n);a>s?(s=a,r.push(e.statement)):(s=this.parse_statement(e,t,s),r.push(e.statement))}return r},s.parse_return_statement=function(e,t,r){var n=this.parse_sequence_expression(e,t,r+1,t.length);return e.statement=new this.ReturnStatement(t[r].start,t[n].end,e.expression),n},s.parse_break_statement=function(e,t,r){var n=r,s=null;return t[n+1]&&this.is_identifier(t[n+1])&&(n=this.parse_identifier(e,t,n+1),s=e.identifier),t[n+1]&&";"===t[n+1].value&&++n,e.statement=new this.BreakStatement(t[r].start,t[n].end,s),n},s.parse_continue_statement=function(e,t,r){var n=r+1,s=null;return t[n]&&this.is_identifier(t[n])&&(n=this.parse_identifier(e,t,n),s=e.identifier),t[n+1]&&";"===t[n+1].value&&++n,e.statement=new this.ContinueStatement(t[r].start,t[n].end,s),n},s.parse_expression_statement=function(e,t,r,n){this.parse_sequence_expression(e,t,r,n),e.statement=new this.ExpressionStatement(t[r].start,t[n].end,e.expression)},s.parse_number_literal=function(){},s.parse_variable_declaration=function(e,t,r,n){for(var s,i=r+1,a=[],o=!0;i<n;++i)switch(t[i].type){case"Number":t[i].error("Unexpected ILLEGAL token");break;case"Identifier":s&&t[i].error_unexpected_type(),i=this.parse_identifier(e,t,i),s=new this.VariableDeclarator(e.identifier),o=!1;break;case"SpecialCharacter":switch(t[i].value){case"=":if(s){if(!t[i+1])throw new Error("Fallback error");i=this.parse_expression(e,t,i+1,n),s.end=e.expression.end_token.end,s.init=e.expression.parsed_token,a.push(s),s=null}else t[i].error_unexpected_token();break;case"$":case"_":s&&t[i].error_unexpected_type(),i=this.parse_identifier(e,t,i),s=new this.VariableDeclarator(e.identifier),o=!1;break;case",":s?(a.push(s),s=null):o&&t[i].error_unexpected_token(),o=!0;break;case";":return o&&t[i].error_unexpected_token(),s&&a.push(s),e.statement=new this.VariableDeclaration(t[r].start,t[i].end,a),i;default:t[i].error_unexpected_token()}break;case"Comment":break;default:t[i].error_unexpected_token()}return a.push(s),e.statement=new this.VariableDeclaration(t[r].start,t[i-1].end,a),i-1},s.parse_function_declaration=function(e,t,r){var n,s,i,a=r+1;return t[a]&&(this.is_identifier(t[a])?(a=this.parse_identifier(e,t,a)+1,s=e.identifier):t[a].error_unexpected_token()),t[a]&&("Parenthesis"===t[a].type?(n=this.parse_parameters(e,t[a].children),++a):t[a].error_unexpected_token()),t[a]&&("Block"===t[a].type?i=new this.BlockStatement(t[a],this.parse_block_statement(t[a].children)):t[a].error_unexpected_token()),e.statement=new this.FunctionDeclaration(t[r].start,i.end,s,n,i),a},s.parse_expression=function(e,t,r,n,s){var i=0,a=[];e:for(;r<n;++r){if("SpecialCharacter"===t[r].type)switch(t[r].value){case",":case";":case s:break e}r=this.parse_expression_piece(e,t,r),e.piece.parsed_token&&a.push(e.piece)}for(this.assemble_pieces(a,0);i<a.length;++i)if(a[i]){e.expression=a[i];break}return r-1},s.parse_expression_piece=function(e,t,r){switch(e.piece=new this.Piece(t[r]),t[r].type){case"Number":e.piece.parsed_token=new this.NumberLiteral(t[r]);break;case"String":e.piece.parsed_token=new this.StringLiteral(t[r]);break;case"RegExp":r=this.parse_regex(e.piece,t,r);break;case"Identifier":switch(r=this.parse_identifier(e,t,r),e.identifier.name){case"in":case"void":case"delete":case"typeof":case"instanceof":e.piece.parsed_token=new this.Operator(e.identifier.name);break;default:e.piece.parsed_token=e.identifier}e.piece.start_token=e.piece.end_token=e.token;break;case"Array":case"Block":case"Parenthesis":e.piece.parsed_token={type:t[r].type};break;case"SpecialCharacter":switch(t[r].value){case"_":case"$":r=this.parse_identifier(e,t,r),e.piece.parsed_token=e.identifier,e.piece.start_token=e.piece.end_token=e.token;break;default:r=this.parse_operators(e.piece,t,r)}break;case"Comment":e.piece.parsed_token=null}return e.piece.end_token||(e.piece.end_token=t[r]),r},s.parse_new_expression=function(e,t,r){var n,s=t+1;for(this.assemble_pieces(e,s,r,"Parenthesis");s<e.length;++s)if(e[s]){n=e[s],e[s]=null;break}return"CallExpression"===n.parsed_token.type?e[t].parsed_token=new this.NewExpression(e[t].start_token.start,n.end_token.end,n.parsed_token.callee,n.parsed_token.arguments):e[t].parsed_token=new this.NewExpression(e[t].start_token.start,n.end_token.end,n.parsed_token,[]),e[t].end_token=n.end_token,s},s.parse_unary_expression=function(e,t,r){for(var n,s,i,a=0;a<t.length;++a)switch(s=t[a],e[s].parsed_token.operator){case"--":case"++":return e[s-1]&&e[s-1].parsed_token&&"Operator"!==e[s-1].parsed_token.type&&"NumberLiteral"!==e[s-1].parsed_token.type?(e[s-1].parsed_token=new this.UnaryExpression(e[s-1].start_token.start,e[s].end_token.end,e[s].parsed_token.operator,e[s-1].parsed_token),e[s-1].end_token=e[s].end_token):e[s+1]&&e[s+1].parsed_token&&"Operator"!==e[s+1].parsed_token.type&&"NumberLiteral"!==e[s+1].parsed_token.type&&(e[s+1].parsed_token=new this.UnaryExpression(e[s].start_token.start,e[s+1].end_token.end,e[s].parsed_token.operator,e[s+1].parsed_token,!0),e[s+1].start_token=e[s].start_token),void(e[s]=null);case"+":case"-":case"!":case"~":case"void":case"delete":case"typeof":for(n=s+1;n<e.length;++n)if(e[n]){i=e[n],e[n]=null;break}i||r.error_unexpected_token(),i.parsed_token&&"Operator"===i.parsed_token.type&&i.start_token.error_unexpected_token(),i&&(e[s].parsed_token=new this.UnaryExpression(e[s].start_token.start,i.end_token.end,e[s].parsed_token.operator,i.parsed_token,!0),e[s].end_token=i.end_token)}},s.parse_binary_expression=function(e,t,r){for(var n,s,i,a=0;a<t.length;++a){for(n=t[a]-1;n>=0;--n)if(e[n]){s=e[n],e[n]=null;break}for(n=t[a]+1;n<e.length;++n)if(e[n]){i=e[n],e[n]=null;break}e[t[a]].parsed_token=new r(s.start_token.start,i.end_token.end,s.parsed_token,e[t[a]].parsed_token.operator,i.parsed_token),e[t[a]].start_token=s.start_token,e[t[a]].end_token=i.end_token}},s.parse_member_expression=function(e,t){var r,n,s;switch(e[t].parsed_token.type){case"Operator":for(r=t-1;r>=0;--r)if(e[r]){if(n=e[r],"Parenthesis"===n.parsed_token.type)return!1;e[r]=null;break}for(r=t+1;r>=0;++r)if(e[r]){s=e[r],e[r]=null;break}e[t].parsed_token=new this.MemberExpression(n.start_token.start,s.end_token.end,n.parsed_token,s.parsed_token),e[t].start_token=n.start_token,e[t].end_token=s.end_token;break;case"Array":for(r=t-1;r>=0;--r)if(e[r]&&"Operator"!==e[r].parsed_token.type){if(n=e[r],"Parenthesis"===n.parsed_token.type)return!1;e[r]=null;break}if(s=e[t].parsed_token,this.parse_sequence_expression(s,e[t].start_token.children,0,e[t].start_token.children.length),!s.expression)throw Error("Fallback error");e[t].parsed_token=new this.MemberExpression(n.start_token.start,e[t].end_token.end,n.parsed_token,s.expression,!0),e[t].start_token=n.start_token}return!0},s.parse_function_expression=function(e,t,r){var n,s,i=null,a=t+1;return e[a]?"Identifier"===e[a].parsed_token.type?(i=e[a].parsed_token,e[a]=null,++a):"Parenthesis"!==e[a].parsed_token.type&&e[a].start_token.error_unexpected_token():r.error_unexpected_token(),e[a]?"Parenthesis"===e[a].parsed_token.type?(n=this.parse_parameters(e[a],e[a].start_token.children),e[a]=null,++a):e[a].start_token.error_unexpected_token():r.error_unexpected_token(),e[a]?"Block"===e[a].parsed_token.type?(s=new this.BlockStatement(e[a].start_token,this.parse_block_statement(e[a].start_token.children)),e[a]=null):e[a].start_token.error_unexpected_token():r.error_unexpected_token(),e[t].parsed_token=new this.FunctionExpression(e[t].start_token.start,s.end,i,n,s),a},s.parse_sequence_expression=function(e,t,r,n,s,i){for(var a=[];r<n;++r)if(e.expression=null,r=this.parse_expression(e,t,r,n,i),e.expression&&a.push(e.expression.parsed_token),t[r+1]){if(";"===t[r+1].value||t[r+1].value===i){r+=2;break}","===t[r+1].value?r+=1:t[r+1].error_unexpected_token()}return s?e.expressions=a:a.length>1?e.expression=new this.SequenceExpression(a):1===a.length?e.expression=a[0]:e.expression=null,r-1},s.parse_assignment_expression=function(e,t){for(var r,n,s,i=0;i<t.length;++i){for(r=t[i]-1;r>=0;--r)if(e[r]){n=e[r],e[r]=null;break}switch(n.parsed_token.type){case"Identifier":case"MemberExpression":case"AssignmentExpression":break;default:n.start_token.error("Assigning to rvalue")}for(r=t[i]+1;r<e.length;++r)if(e[r]){s=e[r],e[r]=null;break}e[t[i]].parsed_token=new this.AssignmentExpression(n.start_token.start,s.end_token.end,n.parsed_token,e[t[i]].parsed_token.operator,s.parsed_token),e[t[i]].start_token=n.start_token,e[t[i]].end_token=s.end_token}},s.parse_conditional_expression=function(e,t){for(var r,n,s,i,a,o=0;o<t.length;++o,s=null){for(r=t[o]-1;r>=0;--r)if(e[r]){n=r,s=e[r];break}if(!s)throw Error("Fallback error");if("Operator"===s.parsed_token.type)throw Error("Fallback error");for(r=t[o]+1;r<e.length;++r)if(e[r]){i=e[r],e[r]=null;break}for(r=t[o]+1;r<e.length;++r)if(e[r]){"Operator"===e[r].parsed_token.type?e[r]=null:e[r].start_token.error_unexpected_token();break}for(r=t[o]+1;r<e.length;++r)if(e[r]){a=e[r],e[r]=null;break}e[t[o]]=null,e[n].parsed_token=new this.ConditionalExpression(s.start_token.start,a.end_token.end,s.parsed_token,i.parsed_token,a.parsed_token),e[n].start_token=s.start_token,e[n].end_token=a.end_token}},s.parse_array=function(e){for(var t=0,r=new this.Temp,n=[];t<e.length;++t)"SpecialCharacter"===e[t].type?","===e[t].value?r.to_add?(n.push(r.expression.parsed_token),r.to_add=!1):n.push(null):e[t].error_unexpected_token():(t=this.parse_expression(r,e,t,e.length),r.to_add=!0);return r.to_add&&n.push(r.expression.parsed_token),n},s.parse_switch_cases=function(e,t){var r,n,s,i,a=0,o=[];e:for(;a<t.length;++a){switch(t[a].type){case"Comment":o.push(new this.Comment(t[a]));continue e;case"Identifier":break;default:t[a].error_unexpected_token()}t:switch(t[a].value){case"case":if(r=a,a=this.parse_sequence_expression(e,t,a+1,t.length,!1,":"),!t[a])throw new Error("Fallback error");if(":"===t[a].value){if(s=e.expression,i=[],a+1===t.length){o.push(new this.SwitchCase(t[r].start,t[a].end,s,i));break}r:for(n=a+1;n<t.length;++n)switch(t[n].type){case"Comment":break;case"Identifier":switch(t[n].value){case"case":case"default":o.push(new this.SwitchCase(t[r].start,t[a].end,s,i));break t}break r;default:break r}r:for(++a;a<t.length&&(a=this.parse_statement(e,t,a),i.push(e.statement),t[a+1]);++a)if("Identifier"===t[a+1].type)switch(t[a+1].value){case"case":case"default":break r}o.push(new this.SwitchCase(t[r].start,t[a].end,s,i))}else t[a].error_unexpected_token();break;case"default":if(r=a,!t[a+1])throw new Error("Fallback error");if(":"===t[a+1].value){if(i=[],a+1===t.length){o.push(new this.DefaultCase(t[r].start,t[a+1].end,i));break}r:for(n=a+2;n<t.length;++n)switch(t[n].type){case"Comment":break;case"Identifier":switch(t[n].value){case"case":case"default":a+=1,o.push(new this.DefaultCase(t[r].start,t[a+1].end,i));break t}break r;default:break r}r:for(a+=2;a<t.length&&(a=this.parse_statement(e,t,a),i.push(e.statement),t[a+1]);++a)if("Identifier"===t[a+1].type)switch(t[a+1].value){case"case":case"default":break r}o.push(new this.DefaultCase(t[r].start,t[a].end,i))}else t[a].error_unexpected_token();break;default:t[a].error_unexpected_token()}}return o},s.parse_operators=function(e,t,r){var n=function(e,n){return t[r+1].value===e&&t[r+n].start.index===t[r+(n-1)].end.index};switch(t[r].value){case".":return e.parsed_token=new this.Operator("."),r;case"-":return n("-",1)?(e.parsed_token=new this.Operator("--"),r+1):n("=",1)?(e.parsed_token=new this.Operator("-="),r+1):(e.parsed_token=new this.Operator("-"),r);case"+":return n("+",1)?(e.parsed_token=new this.Operator("++"),r+1):n("=",1)?(e.parsed_token=new this.Operator("+="),r+1):(e.parsed_token=new this.Operator("+"),r);case"/":return n("=",1)?(e.parsed_token=new this.Operator("/="),r+1):(e.parsed_token=new this.Operator("/"),r);case"*":return n("=",1)?(e.parsed_token=new this.Operator("*="),r+1):(e.parsed_token=new this.Operator("*"),r);case"%":return n("=",1)?(e.parsed_token=new this.Operator("%="),r+1):(e.parsed_token=new this.Operator("%"),r);case"=":return n("=",1)?n("=",2)?(e.parsed_token=new this.Operator("==="),r+2):(e.parsed_token=new this.Operator("=="),r+1):(e.parsed_token=new this.Operator("="),r);case"&":return n("&",1)?(e.parsed_token=new this.Operator("&&"),r+1):(e.parsed_token=new this.Operator("&"),r);case"|":return n("|",1)?(e.parsed_token=new this.Operator("||"),r+1):(e.parsed_token=new this.Operator("|"),r);case">":return n("=",1)?(e.parsed_token=new this.Operator(">="),r+1):(e.parsed_token=new this.Operator(">"),r);case"<":return n("=",1)?(e.parsed_token=new this.Operator("<="),r+1):(e.parsed_token=new this.Operator("<"),r);case"!":return n("=",1)?n("=",2)?(e.parsed_token=new this.Operator("!=="),r+2):(e.parsed_token=new this.Operator("!="),r+1):(e.parsed_token=new this.Operator("!"),r);case"?":case":":return e.parsed_token=new this.Operator(t[r].value),
r;default:t[r].error_unexpected_token()}},s.parse_identifier=function(e,r,n){var s=e.identifier=new this.Identifier(r[n]),i=n+1;e:for(;i<r.length;++i)switch(r[i].type){case"Number":case"Identifier":if(r[i-1].end.index!==r[i].start.index)break e;s.name=s.name+r[i].value;break;case"SpecialCharacter":switch(r[i].value){case"$":case"_":if(r[i-1].end.index!==r[i].start.index)break e;s.name=s.name+r[i].value;break;default:break e}break;default:break e}return s.end=r[i-1].end,e.token=new t({type:"Identifier",value:s.name,start:r[n].start,end:r[i-1].end}),i-1},s.parse_parenthesis=function(e,t){for(var r,n,s=t-1,i=e[t].parsed_token;s>=0;--s)if(e[s]){"Operator"!==e[s].parsed_token.type&&(r=e[s],e[s]=null);break}r?(n=this.parse_arguments(i,e[t].start_token.children),e[t].parsed_token=new this.CallExpression(r.start_token.start,e[t].end_token.end,r.parsed_token,n),e[t].start_token=r.start_token):(this.parse_sequence_expression(i,e[t].start_token.children,0,e[t].start_token.children.length),e[t].parsed_token=i.expression)},s.REGEX_FLAGS="gimuy",s.parse_regex=function(e,t,r){var n,s,i=r+1,a=0,o="";if(t[i]&&t[r].end.index===t[i].start.index&&"Identifier"===t[i].type)for(s=t[i].value,n=!0;a<s.length;++a)-1!==this.REGEX_FLAGS.indexOf(s.charAt(a))&&-1===o.indexOf(s.charAt(a))?o+=s.charAt(a):t[i].error("Invalid regular expression flags");return n||(o="",i=r),e.parsed_token=new this.RegExpLiteral(t[r].start,t[i].end,t[r].value,o),i},s.parse_arguments=function(e,t){return this.parse_sequence_expression(e,t,0,t.length,!0),e.expressions},s.parse_for_arguments=function(e,t){var r=t[0]&&"var"===t[0].value?1:0;if(!t[r])throw Error("error");switch(e.identifier=null,this.is_identifier(t[r])?(r=this.parse_identifier(e,t,r),e.type=t[r+1]&&"in"===t[r+1].value?"in":"loop"):e.type="loop",e.type){case"in":if("var"===t[0].value?e.left=new this.VariableDeclaration(t[0].start,e.identifier.end,[new this.VariableDeclarator(e.identifier)]):e.left=e.identifier,r=this.parse_sequence_expression(e,t,r+2,t.length),!e.expression)throw Error("error");e.right=e.expression;break;case"loop":if("var"===t[0].value?(r=this.parse_variable_declaration(e,t,0,t.length),e.init=e.statement):(r=this.parse_sequence_expression(e,t,0,t.length),e.init=e.expression),";"!==t[r].value)throw Error("ERROR");if(r=this.parse_sequence_expression(e,t,r+1,t.length),e.test=e.expression,";"!==t[r].value)throw Error("ERROR");r=this.parse_sequence_expression(e,t,r+1,t.length),e.update=e.expression}},s.parse_parameters=function(e,t){for(var r=0,n=[];r<t.length;++r)this.is_identifier(t[r])?(r=this.parse_identifier(e,t,r),t[r+1]&&(","===t[r+1].value?++r:t[r+1].error_unexpected_token()),n.push(e.identifier)):t[r].error_unexpected_token();return n},s.parse_test=function(e,t){if(this.parse_sequence_expression(e,t,0,t.length),e.expression)return e.expression;throw Error("Fallback error")},s.parse_object_literal=function(e){for(var t,r,n=0,s=[],i=new this.Temp,a=e.children;n<a.length;++n)if(t||!this.is_identifier(a[n]))switch(a[n].type){case"Number":t&&a[n].error_unexpected_type(),t=new this.Property(new this.NumberLiteral(a[n])),r=!0;break;case"String":t&&a[n].error_unexpected_type(),t=new this.Property(new this.StringLiteral(a[n])),r=!0;break;case"Array":break;case"SpecialCharacter":switch(a[n].value){case":":r?(n=this.parse_expression(i,a,n+1,a.length),r=!1,t.value=i.expression.parsed_token):t?(n=this.parse_expression(i,a,n+1,a.length),t.value=i.expression.parsed_token):a[n].error_unexpected_token(),s.push(t),t=null;break;case",":r?a[n].error_unexpected_token():t&&(t.value=t.key,t.end=t.value.end,s.push(t),t=null);break;default:a[n].error_unexpected_token()}break;default:a[n].error_unexpected_token()}else n=this.parse_identifier(i,a,n),t=new this.Property(i.identifier);if(t){if(r)throw Error("Fallback error");t.value=t.key,t.end=t.value.end,s.push(t)}return new this.ObjectLiteral(e,s)},s.parse_block=function(e,t){e[t].parsed_token=this.parse_object_literal(e[t].start_token)},s.assemble_pieces=function(e,t,r,n){for(var s=[],i=[],a=[],o=[],p=[],h=[],c=[],_=[],u=[],d=[];t<e.length;++t){switch(e[t].parsed_token.type){case"Identifier":switch(e[t].parsed_token.name){case"new":t=this.parse_new_expression(e,t);break;case"function":t=this.parse_function_expression(e,t)}break;case"Operator":switch(e[t].parsed_token.operator){case"?":u.unshift(t);break;case"&&":case"||":_.push(t);break;case".":s.push({index:t});break;case"!":case"~":case"++":case"--":case"void":case"delete":case"typeof":a.unshift(t);break;case"<":case">":case"<=":case">=":case"==":case"===":case"!=":case"!==":c.push(t);break;case"+":case"-":e[t-1]&&"Operator"===e[t-1].parsed_token.type?a.unshift(t):p.push(t);break;case"*":case"/":case"%":o.push(t);break;case"=":case"+=":case"-=":case"*=":case"/=":case"%=":case"&=":case"^=":case"|=":case"**=":case"<<=":case">>=":case">>>=":d.push(t)}break;case"Parenthesis":i.push(t);break;case"Array":e[t-1]&&"Operator"!==e[t-1].parsed_token.type?s.push({index:t}):e[t].parsed_token=new this.ArrayLiteral(e[t].start_token,this.parse_array(e[t].start_token.children));break;case"Block":this.parse_block(e,t)}if(n&&e[t].parsed_token.type===n)break}for(t=0;t<s.length;++t)s[t].is_parsed=this.parse_member_expression(e,s[t].index);for(t=i.length-1;t>=0;--t)this.parse_parenthesis(e,i[t]);for(t=0;t<s.length;++t)s[t].is_parsed||this.parse_member_expression(e,s[t].index);this.parse_unary_expression(e,a),this.parse_binary_expression(e,o,this.BinaryExpression),this.parse_binary_expression(e,p,this.BinaryExpression),this.parse_binary_expression(e,h,this.BinaryExpression),this.parse_binary_expression(e,c,this.BinaryExpression),this.parse_binary_expression(e,_,this.LogicalExpression),this.parse_conditional_expression(e,u),this.parse_assignment_expression(e,d)},s.is_identifier=function(e){return"Identifier"===e.type||"$"===e.value||"_"===e.value},s.error_end_of_file=function(){this.raw_tokens[this.raw_tokens.length-1].error("Unexpected end of file")};var i=function(){this.middlewares=[]};return s=i.prototype,s.JavascriptParser=n,s.middleware=function(e){this.middlewares.push(e)},s.clone_middlewares=function(){for(var e=0,t=new Array(this.middlewares.length);e<t.length;++e)t[e]=this.middlewares[e];return t},s.parse=function(e,t){return new this.JavascriptParser(this.clone_middlewares()).parse(e,t)},i}),n.namespace("javascript.ES5_parser",["javascript.tokenizer","javascript.Parser"],function(e,t){var r=new t;return function(e,t){try{return r.parse(e,t)}catch(t){throw t.fileName=e,t.$stack=t.stack,t}}})}(window.jeefo,window,document);